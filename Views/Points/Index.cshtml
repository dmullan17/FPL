@using Newtonsoft.Json;

@model FPL.ViewModels.FPL.GameweekPointsViewModel

@{ var data = JsonConvert.SerializeObject(Model); }

@section PageScripts {
    <script src="~/js/points/index.js"></script>
    <script type="text/javascript">
        const viewModel = new GameweekPointsViewModel(@Html.Raw(data));
        ko.applyBindings(viewModel, document.getElementById("app"));
    </script>
}

<div id="app">
    <div class="ui container">
        @*<h3 class="ui header" data-bind="with: $root.Team()">
                <span data-bind="text: name"></span>
            </h3>*@
        <div class="ui grid">
            <div class="row">
                <div class="column" style="padding-top: 0.5rem; width: fit-content; margin-right: 1rem;">
                    <h4 class="ui header">
                        <span data-bind="text: $root.Team().name"></span>
                        <div class="sub header" data-bind="text: $root.Team().player_first_name + ' ' + $root.Team().player_last_name"></div>
                        <i data-bind="class: $root.GetFlagClass($root.Team().player_region_iso_code_short)"></i>
                    </h4>
                </div>
                <div class="twelve wide column">
                    <div id="points-statistics-row" class="ui small statistics">
                        <div class="statistic">
                            <div data-bind="text: $root.GetGWPoints($root.GWPoints())" class="value"></div>
                            <div class="label" data-bind="text: 'GW' + $root.GameweekId() + ' Points'"></div>
                        </div>
                        <div id="gw-percentile-statistic" class="statistic" style="margin-top: 1em">
                            <div class="text value">
                                <span>Top</span>
                                <span style="font-size: 2.5rem !important;" data-bind="text: $root.EntryHistory().GwRankPercentile + '%'"></span>
                            </div>
                            <div class="label" data-bind="text: 'GW' + $root.GameweekId() + ' Percentile'"></div>
                        </div>
                        <div id="gw-average-statistic" class="statistic" data-bind="with: $root.GameWeek()">
                            <div data-bind="text: average_entry_score" class="value"></div>
                            <div class="label" data-bind="text: 'GW' + $root.GameweekId() + ' Avg Score'"></div>
                        </div>
                        @*<div class="statistic">
                    <div data-bind="text: $root.GetTotalPoints($root.TotalPoints())" class="value"></div>
                    <div class="label">Total Points</div>
                </div>
                <div id="total-percentile-statistic" class="statistic" style="margin-top: 1em">
                    <div class="text value">
                        <span>Top</span>
                        <span style="font-size: 2.5rem !important;" data-bind="text: $root.EntryHistory().TotalRankPercentile + '%'"></span>
                        <i data-bind="class: $root.GetTotalPercentileMovement($root.EntryHistory())"></i>
                    </div>
                    <div class="label">Total Percentile</div>
                </div>*@
                        @*<div class="statistic" data-bind="with: $root.Team()">
                    <div data-bind="text: $root.FormatLargeNumber(summary_event_rank)" class="value"></div>
                    <div class="label" data-bind="text: 'GW' + $root.GameweekId() + ' Rank'"></div>
                </div>
                <div class="statistic" data-bind="with: $root.Team()">
                    <div data-bind="text: $root.FormatLargeNumber(summary_overall_rank)" class="value"></div>
                    <div class="label">Total Rank</div>
                </div>*@
                        <div id="captain-points-statistic" class="statistic">
                            <div data-bind="text: $root.GetCaptainPointsTotal($root.GWTeam())" class="value"></div>
                            <div class="label">Captain Points</div>
                        </div>
                        <div class="statistic">
                            <div data-bind="text: $root.GetBenchPointsTotal($root.GWTeam())" class="value"></div>
                            <div class="label">Bench Points</div>
                        </div>
                        <div class="statistic" data-bind="visible: $root.GameweekId() == $root.CurrentGameweekId()">
                            <div data-bind="text: $root.GWTeam().PlayersYetToPlay" class="value"></div>
                            <div class="label">Picks YTP</div>
                        </div>
                        <div class="statistic" data-bind="visible: $root.GWTeam().ActiveChips.length > 0">
                            <div class="value">
                                <i class="gem outline icon"></i>
                            </div>
                            <div class="label" data-bind="text: $root.GWTeam().ActiveChips"></div>
                        </div>
                        @*<div class="statistic" data-bind="with: $root.GameWeek()">
                    <div data-bind="text: highest_score" class="value"></div>
                    <div class="label" data-bind="text: 'GW' + $root.GameweekId() + ' Top Score'"></div>
                </div>*@
                    </div>
                </div>
                <div class="right floated column" style="width: 8.5% !important;">
                    <select class="ui dropdown" style="padding: 0 !important; height: 30px !important;" 
                            data-bind="options: AllStartedGameWeeks,
                                       optionsText: function(gw) {
                                            return 'GW ' + gw.id
                                       },
                                       value: $root.SelectedGameweek">
                    </select>
                </div>
            </div>

            @*<div class="eight wide column">
                    <h4 class="ui header">
                        Total Points: <span data-bind="text: $root.GetTotalPoints($root.TotalPoints())"></span>
                    </h4>
                    <h4 class="ui header">
                        GW<span data-bind="text: $root.GameweekId()"></span> Points: <span data-bind="text: $root.GetGWPoints($root.GWPoints())"></span>
                    </h4>
                    <h4 class="ui header">
                        GW Rank Percentile: <span data-bind="text: $root.EntryHistory().RankPercentile"></span>
                    </h4>
                </div>
                <div class="eight wide right aligned column">
                    <h4 class="ui header" data-bind="visible: $root.GWTeam().ActiveChips.length > 0">
                        Active Chips:
                        <!-- ko foreach: $root.GWTeam().ActiveChips -->
                        <!-- ko if: $index() > 0 --><!--,--> <!-- /ko -->
                        <!--<span data-bind="text: $data"></span>-->
                        <!-- /ko -->
                    </h4>
                </div>*@

        </div>
        <table class="ui table">
            <thead>
                <tr>
                    <th>Name</th>
                    <th data-bind="visible: $root.GWTeam().automatic_subs.length > 0"></th>
                    <th>Position</th>
                    <th>Opposition</th>
                    @*<th>Time</th>*@
                    <th class="center aligned">Mins</th>
                    <th class="center aligned">GF</th>
                    <th class="center aligned">CS</th>
                    <th class="center aligned">GA</th>
                    <th class="center aligned">Assists</th>
                    <th class="center aligned">Saves</th>
                    <th class="center aligned">Bonus</th>
                    <th class="center aligned">Bps (Rank)</th>
                    @*<th>Bps Rank</th>*@
                    <th class="center aligned">GW <span data-bind="text: $root.GameweekId()"></span></th>
                    <th colspan="2"></th>
                </tr>
            </thead>
            <tbody data-bind="foreach: $root.GWTeam().picks">
                <tr data-bind="style: { 'background-color': $root.getColor($data.position) }">
                    <td>
                        <a data-bind="click: $root.viewPlayer"><span data-bind="text: player.web_name"></span></a>
                        <span data-bind="visible: is_captain"><i class="copyright icon"></i></span>
                        <span data-bind="visible: GWPlayer.stats.in_dreamteam"><i class="star icon"></i></span>
                        <i class="ui icon" data-bind="visible: $root.DoesPlayerHaveStatus(player.status), class: $root.GetPlayerStatusIcon(player.status), click: $root.ShowStatusPopup(player.status)"></i>
                        <i class="yellow square icon" data-bind="visible: GWPlayer.stats.yellow_cards > 0"></i>
                        <i class="red square icon" data-bind="visible: GWPlayer.stats.red_cards > 0"></i>
                    </td>
                    <td data-bind="visible: $root.GWTeam().automatic_subs.length > 0">
                        <span data-bind="visible: $root.SubOn($data)">On</span>
                        <span data-bind="visible: $root.SubOff($data)">Off</span>
                    </td>
                    <td>
                        <span data-bind="text: $root.GetPosition(player.element_type)"></span>
                    </td>
                    <td>
                        <span data-bind="html: $root.GetOpposition($data)"></span>
                    </td>
                    <!--<td data-bind="class: GWGame.finished_provisional || !GWGame.started ? '' : 'center aligned'">-->
                    @*<span data-bind="text: $root.GetTime($data), visible: GWGame.finished_provisional || !GWGame.started"></span>*@
                    <!--<span class="ui green label" data-bind="visible: !GWGame.finished_provisional && GWGame.started">Live</span>
                    </td>-->
                    <td class="center aligned">
                        <span data-bind="text: GWPlayer.stats.minutes"></span>
                    </td>
                    <td class="center aligned">
                        <span data-bind="text: GWPlayer.stats.goals_scored"></span>
                    </td>
                    <td class="center aligned">
                        <span data-bind="text: GWPlayer.stats.clean_sheets"></span>
                    </td>
                    <td class="center aligned">
                        <span data-bind="text: GWPlayer.stats.goals_conceded"></span>
                    </td>
                    <td class="center aligned">
                        <span data-bind="text: GWPlayer.stats.assists"></span>
                    </td>
                    <td class="center aligned">
                        <span data-bind="text: GWPlayer.stats.saves"></span>
                    </td>
                    <td class="center aligned">
                        <span data-bind="text: $root.GetBonus($data)"></span>
                    </td>
                    <td class="center aligned">
                        <span data-bind="text: GWPlayer.stats.bps + ' (' + $root.GetBonusRank($data) + ')'"></span>
                    </td>
                    @*<td>
                            <span data-bind="text: $root.GetBonusRank($data)"></span>
                        </td>*@
                    <td class="center aligned">
                        <span data-bind="text: $root.GetPoints($data)"></span>
                    </td>
                    <td @*data-bind="class: $root.GetResult($data, $data.GWGame)"*@ class="center aligned collapsing">
                        @*<span class="ui green label" data-bind="visible: !GWGame.finished_provisional && GWGame.started">Live</span>*@
                        @*<span data-bind="visible: GWGame.started, text: GWGame.team_h_score + ' - ' + GWGame.team_a_score"></span>*@
                        <span data-bind="html: $root.GetTimeOrResult($data) @*visible: !GWGame.started*@"></span>
                        @*<span data-bind="visible: GWGame.finished_provisional"><i class="check icon"></i></span>*@
                    </td>
                    @*<td data-bind="class: $root.GetResult($data, $data.GWGame)" class="center aligned collapsing">
                            <span class="ui mini green label" data-bind="visible: !GWGame.finished_provisional && GWGame.started">Live</span>
                            <span data-bind="visible: GWGame.finished_provisional">
                                <i class="small check icon"></i>
                            </span>
                        </td>*@
                </tr>
            </tbody>
        </table>
        <div id="gw-percentile-popup" class="ui hidden stat popup" data-bind="style: {'height': $root.GetGwPercentilePopupHeight($root.GameweekId())}">
            <p style="text-align: center;" data-bind="text: 'Ranked ' + $root.FormatLargeNumber(CompleteEntryHistory().rank) + ' out of ' + $root.FormatLargeNumber($root.EntryHistory().TotalPlayers)"></p>
            <p data-bind="visible: $root.EventStatus().status[0].event == $root.GameweekId(), text: $root.GetLastTimeGwAvgWasUpdated($root.EventStatus())"></p>
        </div>
        <div id="total-percentile-popup" class="ui hidden stat popup">
            <p data-bind="text: $root.FormatLargeNumber($root.Team().summary_overall_rank) + ' / ' + $root.FormatLargeNumber($root.EntryHistory().TotalPlayers)"></p>
        </div>
        <div id="captain-points-popup" class="ui hidden stat popup">
            <p data-bind="text: $root.GetCaptain($root.GWTeam())"></p>
        </div>
        <div id="gw-average-popup" class="ui hidden stat popup">
            <p data-bind="text: $root.GetLastTimeGwAvgWasUpdated($root.EventStatus())"></p>
        </div>
        <div class="ui modal">
            <i class="close icon"></i>
            <div class="header" data-bind="with: $root.SelectedPlayer()">
                <div data-bind="text: player.web_name"></div>
                <div data-bind="text: player.news"></div>
                <!-- <span data-bind="text: $root.SelectedGame().team_a_score"> -->
                <!-- <span data-bind="text: $root.SelectedGame().team_h_score + ' - ' + $root.SelectedGame().team_a_score"> -->
                @*<div class="ui grid">
                        <div class="six wide right aligned middle aligned column">
                            <h2 class="ui header" data-bind="text: HomeTeam.name"></h3>
                        </div>
                        <div class="four wide center aligned column">
                            <div class="ui large statistic">
                                <div class="value" data-bind="text: team_h_score + ' - ' + team_a_score"></div>
                            </div>
                        </div>
                        <div class="six wide middle aligned column">
                            <h2 class="ui header" data-bind="text: AwayTeam.name"></h3>
                        </div>
                    </div>*@
            </div>
            @*<div class="ui top attached tabular menu">
                    <a class="item active" data-tab="first">First</a>
                    <a class="item" data-tab="second">Second</a>
                    <a class="item" data-tab="third">Third</a>
                </div>
                <div class="ui bottom attached tab segment active" data-tab="first">
                    <div class="image content">
                        <table class="ui table">
                            <thead data-bind="with: $root.Game()">
                            <th></th>
                            <th data-bind="text: HomeTeam.name"></th>
                            <th data-bind="text: AwayTeam.name"></th>
                            </thead>
                            <tbody data-bind="foreach: $root.GameStats">
                                <tr>
                                    <td data-bind="text: identifier"></td>
                                    <td data-bind="foreach: h">
                                        <span data-bind="text: Player.web_name"></span>
                                        <span data-bind="text: value"></span>
                                    </td>
                                    <td data-bind="foreach: a">
                                        <span data-bind="text: Player.web_name"></span>
                                        <span data-bind="text: value"></span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="ui bottom attached tab segment" data-tab="second">
                    <div class="ui grid">
                        <div class="eight wide column">
                            <h3 class="ui header" data-bind="with: $root.Game()">
                                <span data-bind="text: HomeTeam.name"></span>
                            </h3>
                            <table class="ui table">
                                <thead>
                                <th>Name</th>
                                <th>Position</th>
                                <th>Minutes</th>
                                <th>Goals</th>
                                <th>Goals Conceded</th>
                                <th>Assists</th>
                                </thead>
                                <tbody data-bind="foreach: $root.SelectedHomeGWPlayerStats">
                                    <tr>
                                        <td>
                                            <span data-bind="text: player.web_name"></span>
                                        </td>
                                        <td>
                                            <span data-bind="text: player.element_type"></span>
                                        </td>
                                        <td>
                                            <span data-bind="text: stats.minutes"></span>
                                        </td>
                                        <td>
                                            <span data-bind="text: stats.goals_scored"></span>
                                        </td>
                                        <td>
                                            <span data-bind="text: stats.goals_conceded"></span>
                                        </td>
                                        <td>
                                            <span data-bind="text: stats.assists"></span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="eight wide column">
                            <h3 class="ui header" data-bind="with: $root.Game()">
                                <span data-bind="text: AwayTeam.name"></span>
                            </h3>
                            <table class="ui table">
                                <thead>
                                <th>Name</th>
                                <th>Position</th>
                                <th>Minutes</th>
                                <th>Goals</th>
                                <th>Goals Conceded</th>
                                <th>Assists</th>
                                </thead>
                                <tbody data-bind="foreach: $root.SelectedAwayGWPlayerStats">
                                    <tr>
                                        <td>
                                            <span data-bind="text: player.web_name"></span>
                                        </td>
                                        <td>
                                            <span data-bind="text: player.element_type"></span>
                                        </td>
                                        <td>
                                            <span data-bind="text: stats.minutes"></span>
                                        </td>
                                        <td>
                                            <span data-bind="text: stats.goals_scored"></span>
                                        </td>
                                        <td>
                                            <span data-bind="text: stats.goals_conceded"></span>
                                        </td>
                                        <td>
                                            <span data-bind="text: stats.assists"></span>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                </div>
                <div class="ui bottom attached tab segment" data-tab="third">
                    Third
                </div>
                <div class="actions">
                    <div class="ui black deny button">
                        Nope
                    </div>
                    <div class="ui positive right labeled icon button">
                        Yep, that's me
                        <i class="checkmark icon"></i>
                    </div>
                </div>*@
        </div>
    </div>
</div>